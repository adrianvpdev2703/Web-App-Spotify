<%- include('../partials/header', { title: 'Administrar Artistas x Género' }) %>

<div class="container mt-4">
  <h2 class="text-white">Artistas x Género</h2>

  <!-- Insert -->
  <form id="form-insert-relacion">
    <h4 class="text-white">Crear Relación</h4>
    <div class="mb-3">
      <label class="form-label text-white">ID Género</label>
      <input type="number" name="genero" class="form-control" required />
    </div>
    <div class="mb-3">
      <label class="form-label text-white">ID Artista</label>
      <input type="number" name="artista" class="form-control" required />
    </div>
    <button class="btn btn-success">Crear</button>
  </form>

  <!-- PUT -->
  <form id="form-put-relacion" class="mt-3">
    <h4 class="text-white">Actualizar Relación (PUT)</h4>
    <div class="mb-3">
      <label class="form-label text-white">ID Relación</label>
      <input type="number" name="id" class="form-control" required />
    </div>
    <div class="mb-3">
      <label class="form-label text-white">ID Género</label>
      <input type="number" name="genero" class="form-control" required />
    </div>
    <div class="mb-3">
      <label class="form-label text-white">ID Artista</label>
      <input type="number" name="artista" class="form-control" required />
    </div>
    <button class="btn btn-primary">Actualizar (PUT)</button>
  </form>

  <!-- PATCH -->
  <form id="form-patch-relacion" class="mt-3">
    <h4 class="text-white">Actualizar Relación (PATCH)</h4>
    <div class="mb-3">
      <label class="form-label text-white">ID Relación</label>
      <input type="number" name="id" class="form-control" required />
    </div>
    <div class="mb-3">
      <label class="form-label text-white">ID Género</label>
      <input type="number" name="genero" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label text-white">ID Artista</label>
      <input type="number" name="artista" class="form-control" />
    </div>
    <button class="btn btn-warning">Actualizar (PATCH)</button>
  </form>

  <!-- DELETE -->
  <form id="form-delete-relacion" class="mt-3">
    <h4 class="text-white">Eliminar Relación</h4>
    <div class="mb-3">
      <label class="form-label text-white">ID Relación</label>
      <input type="number" name="id" class="form-control" required />
    </div>
    <button class="btn btn-danger">Eliminar</button>
  </form>

  <div id="resultado" class="mt-3 text-white"></div>
</div>

<script>
  const resultado = document.getElementById("resultado");

  async function parseResponse(res) {
    const ct = res.headers.get("content-type") || "";
    if (ct.includes("application/json")) {
      const json = await res.json();
      if (!res.ok) throw new Error(json.error || JSON.stringify(json));
      return json;
    } else {
      const text = await res.text();
      if (!res.ok) throw new Error(text || `Error ${res.status}`);
      return text;
    }
  }

  // INSERT
  document
    .getElementById("form-insert-relacion")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      resultado.textContent = "Enviando...";
      const body = Object.fromEntries(new FormData(e.target).entries());
      try {
        const res = await fetch("/artistaxgenero", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const data = await parseResponse(res);
        resultado.innerHTML =
          "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
      } catch (err) {
        resultado.textContent = "Error: " + err.message;
      }
    });

  // PUT
  document
    .getElementById("form-put-relacion")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const id = form.querySelector('[name="id"]').value.trim();
      if (!id) return (resultado.textContent = "Error: falta el ID");
      resultado.textContent = "Enviando (PUT)...";
      const body = Object.fromEntries(new FormData(form).entries());
      delete body.id;
      try {
        const res = await fetch(`/artistaxgenero/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const data = await parseResponse(res);
        resultado.innerHTML =
          "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
      } catch (err) {
        resultado.textContent = "Error: " + err.message;
      }
    });

  // PATCH
  document
    .getElementById("form-patch-relacion")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const id = form.querySelector('[name="id"]').value.trim();
      if (!id) return (resultado.textContent = "Error: falta el ID");
      resultado.textContent = "Enviando (PATCH)...";
      const body = Object.fromEntries(new FormData(form).entries());
      delete body.id;
      try {
        const res = await fetch(`/artistaxgenero/${id}`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const data = await parseResponse(res);
        resultado.innerHTML =
          "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
      } catch (err) {
        resultado.textContent = "Error: " + err.message;
      }
    });

  // DELETE
  document
    .getElementById("form-delete-relacion")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = e.target.querySelector('[name="id"]').value.trim();
      if (!id) return (resultado.textContent = "Error: falta el ID");
      resultado.textContent = "Eliminando...";
      try {
        const res = await fetch(`/artistaxgenero/${id}`, { method: "DELETE" });
        const data = await parseResponse(res);
        resultado.innerHTML =
          "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
      } catch (err) {
        resultado.textContent = "Error: " + err.message;
      }
    });
</script>

<%- include('../partials/footer') %>
